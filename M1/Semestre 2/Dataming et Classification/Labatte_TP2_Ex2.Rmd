---
title: "RD2 - TP ACP"
output:
  pdf_document: default
  html_notebook: default
---

```{r}
library(FactoMineR);library(factoextra);library("corrplot")
```

# Exercice II: Reprendre l'ACP sur le fichier csp.txt
Le tableau des données indique les dépenses annuelles moyennes de consommation
de douze catégories socio-professionnelles. Les douze individus du tableau, qui sont ici présentés
en ligne, désignent des catégories socio-professionnelles caractérisées par la CSP variable
qualitative à trois modalités (1 = manoeuvre, 2 = employé et 3 = cadre) et le nombre d’enfants
(2, 3, 4 ou 5). Par exemple, l’individu MA2 désigne la catégorie "manoeuvre avec deux enfants",
EM2 la catégorie "employé avec deux enfants", CA2 la catégorie "cadre avec deux enfants", etc.
Les sept premières variables, qui sont présentées ici en colonne, sont les variables actives. Ces
variables désignent respectivement les dépenses annuelles moyennes de consommation en pain,
légumes, fruits, viande, volaille, lait et vin. On effectue l’ACP normée (ACPN) de ce tableau en
considérant comme supplémentaires les variables "csp" et "nb". 

1. Commenter brièvement le tableau des statistiques sommaires.
```{r}
CSP =read.table('csp.txt',t=T)
CSP$nb=as.factor(CSP$nb)
summary(CSP)
CSP
```

2. Que peut-on dire des corrélations entre variables ?
Les variables légumes, fruit, viande et volaille sont positivement corrélés entre eux.
Le lait est positivement corrélé au lait, et la viande est très peu corrélée avec les autres variables.

```{r}
round(cor(CSP[,1:7]),2) #la matrice des corrélations
corrplot(cor(CSP[,1:7]))

```


3. Que vaut l’inertie totale dans l’ACP normée effectuée et la contribution relative de chaque axe à l’inertie totale?
L'inertie totale est 7 (car on a 7 variables quantitatives)
La contribution de l'axe 1 à l'inertie totale est de 61,90%
La contribution de l'axe 2 à l'inertie totale est de 26,15%
```{r}
csp=PCA(CSP,quali.sup=8:9) 
```


5. Combien d’axes factoriels pensez-vous qu’il faille retenir ?

On peut choisir de retenir que 2 axes variables (règle de Kaiser et méthode du coude, et on a 88% du jeu de donnés, ce qui est largement suffisant je pense).
On pourra aussi décider de prendre l'axe 3 (même s'il la contribution n'est que de 9%) mais retenir les axes 4,5,6 et 7 sera inutile au vue de peu d'information qu'ils rapportent.
```{r}
csp$eig
fviz_eig(csp,addlabels = TRUE)
```

6. Calculer la contribution  de chaque variable  au a ème facteur (a = 1, 2).

```{r}
fviz_contrib(csp,choice =  "var",axes=1) #la contribution  de chaque variable  au 1 ème facteur 
fviz_contrib(csp,choice =  "var",axes=2) #la contribution  de chaque variable  au 2 ème facteur 
```


7. Calculer le carré de la corrélation CORa(i) de chaque variable  avec le a ème facteur (a = 1, 2), puis la qualité de la représentation associée QLT2(i) dans le plan factoriel 1  2.

```{r}
var = get_pca_var(csp)
var$cor

plot.PCA(csp,choix="var",select="cos2 0.5") 
corrplot(csp$ind$contrib,is.corr = FALSE)
fviz_cos2(csp, choice = "var", axes = 1:2)

```
8. Quel est l’intérêt de ranger les variables par corrélation décroissante avec le premier facteur (ou première composante principale) pour examiner la matrice de corrélation ?
9. Quelles sont les variables caractéristiques du premier axe factoriel ?
Légume, fruit, viande et volaille.
```{r}

corrplot(csp$var$contrib,is.corr = FALSE)
fviz_contrib(csp,"var",axes = 1)

```
10. Quelles sont les variables caractéristiques du deuxième axe factoriel ?
Pain, lait et vin.
```{r}
fviz_contrib(csp,"var",axes = 2)
```
11. Interpréter le cercle des corrélations.
Tous les variables sont bien représentés, car longueur proche de 1 (le vin est un peu moins bien représenté que les autres variables).
Volaille et fruit sont fortement corrélés (ils sont superposés). Ces deux variables sont aussi corrélés à Viande.
Pain et lait sont positivement corrélés.
Vin et légume ne sont pas corrélés du tout (angle droit).
```{r}
plot.PCA(csp,choix="var",select="contrib 10 ")
```
12. Quelles sont les observations caractéristiques du premier axe factoriel (on se basera sur les contributions de chaque observation i au premier axe factoriel).
CA5 et MA2.
```{r}

fviz_contrib(csp,"ind",axes = 1)

```
13. Donner la qualité de représentation de chaque observation i sur le plan des deux premiers axes factoriels.
```{r}

fviz_pca_ind (csp, col.ind = "cos2", gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),repel = TRUE )
corrplot(csp$ind$contrib,is.corr = FALSE)

```
14. Quelles sont les observations caractéristiques du deuxième axe factoriel ?
MA5, EM2, CA4, MA4 et CA3.
```{r}
fviz_contrib(csp,"ind",axes = 2)
```
15. Interpréter le plan des deux premiers axes factoriels (on aura intérêt à joindre tous les points associés à une famille ayant le même nombre d’enfants et, de même, tous les points associés à une même CSP).
```{r}
fviz_pca_ind (csp,habillage=8,addEllipses = TRUE)
fviz_pca_ind (csp,habillage=9,addEllipses = TRUE)
```
